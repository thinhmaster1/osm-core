var BillController=function(){function s(){$("#txtFromDate, #txtToDate").datepicker({autoclose:!0,format:"dd/mm/yyyy"});$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"en",rules:{txtCustomerName:{required:!0},txtCustomerAddress:{required:!0},txtCustomerMobile:{required:!0},ddlBillStatus:{required:!0}}});$("#txt-search-keyword").keypress(function(t){t.which===13&&(t.preventDefault(),n())});$("#btn-search").on("click",function(){n()});$("#btn-create").on("click",function(){i();$("#modal-detail").modal("show")});$("#ddl-show-page").on("change",function(){osm.configs.pageSize=$(this).val();osm.configs.pageIndex=1;n(!0)});$("body").on("click",".btn-view",function(n){n.preventDefault();var t=$(this).data("id");$.ajax({type:"GET",url:"/Admin/Bill/GetById",data:{id:t},beforeSend:function(){osm.startLoading()},success:function(n){var t=n,a,l,v;$("#hidId").val(t.Id);$("#hidCustomerId").val(t.CustomerId);$("#hidDC").val(t.DateCreated);$("#hidStatus").val(t.Status);$("#txtCustomerName").val(t.CustomerName);$("#txtCustomerAddress").val(t.CustomerAddress);$("#txtCustomerMobile").val(t.CustomerMobile);$("#txtCustomerMessage").val(t.CustomerMessage);$("#ddlPaymentMethod").val(t.PaymentMethod);$("#ddlBillStatus").val(t.BillStatus);a=t.BillDetails;t.BillDetails!=null&&t.BillDetails.length>0&&(l="",v=$("#template-table-bill-details").html(),$.each(a,function(n,t){var i=u(t.ProductId),r=f(t.ColorId),e=o(t.SizeId);l+=Mustache.render(v,{Id:t.Id,Products:i,Colors:r,Sizes:e,Quantity:t.Quantity})}),$("#tbl-bill-details").html(l));var i=document.getElementById("btnPending"),r=document.getElementById("btnConfirm"),e=document.getElementById("btnCancel"),s=document.getElementById("btnSave"),h=document.getElementById("btnReturn"),c=document.getElementById("btnRefuse");t.BillStatus==0?(i.disabled=!1,e.disabled=!1,s.disabled=!1,h.disabled=!0,c.disabled=!0,r.disabled=!0):t.BillStatus==1?(i.disabled=!0,s.disabled=!0,e.disabled=!0,h.disabled=!0,c.disabled=!0,r.disabled=!1):t.BillStatus==2&&t.Status==1?(i.disabled=!0,s.disabled=!0,e.disabled=!0,h.disabled=!1,c.disabled=!1,r.disabled=!0):(i.disabled=!0,s.disabled=!0,e.disabled=!0,h.disabled=!0,c.disabled=!0,r.disabled=!0);$("#modal-detail").modal("show");osm.stopLoading()},error:function(){osm.notify("Has an error in progress","error");osm.stopLoading()}})});$("#btnSave").on("click",function(){if($("#frmMaintainance").valid()){e.preventDefault();var t=$("#hidId").val(),r=$("#hidCustomerId").val(),f=$("#hidDC").val(),o=$("#hidStatus").val(),s=$("#txtCustomerName").val(),h=$("#txtCustomerAddress").val(),c=$("#txtCustomerMobile").val(),l=$("#txtCustomerMessage").val(),a=$("#ddlPaymentMethod").val(),v=$("#ddlBillStatus").val(),u=[];return $.each($("#tbl-bill-details tr"),function(n,i){u.push({Id:$(i).data("id"),ProductId:$(i).find("select.ddlProductId").first().val(),Quantity:$(i).find("input.txtQuantity").first().val(),ColorId:$(i).find("select.ddlColorId").first().val(),SizeId:$(i).find("select.ddlSizeId").first().val(),BillId:t})}),$.ajax({type:"POST",url:"/Admin/Bill/SaveEntity",data:{Id:t,CustomerId:r,DateCreated:f,BillStatus:v,CustomerAddress:h,CustomerId:r,CustomerMessage:l,CustomerMobile:c,CustomerName:s,PaymentMethod:a,Status:o,BillDetails:u},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(){osm.notify("Save order successful","success");$("#modal-detail").modal("hide");i();osm.stopLoading();n(!0)},error:function(){osm.notify("Has an error in progress","error");osm.stopLoading()}}),!1}});$("#btnPending").on("click",function(){$.ajax({url:"/Admin/Bill/UpdateStatus",type:"post",data:{billId:$("#hidId").val(),billStatus:1,status:1},dataType:"json",success:function(){osm.notify("The order is shipping.","success");$("#modal-detail").modal("hide");i();n(!0)}})});$("#btnConfirm").on("click",function(){$.ajax({url:"/Admin/Bill/UpdateStatus",type:"post",data:{billId:$("#hidId").val(),billStatus:4,status:1},dataType:"json",success:function(){osm.notify("The order is paid.","success");$("#modal-detail").modal("hide");i();n(!0)}})});$("#btnCancel").on("click",function(){e.preventDefault();$.ajax({url:"/Admin/Bill/UpdateStatus",type:"post",data:{billId:$("#hidId").val(),billStatus:3,status:0},dataType:"json",success:function(){osm.notify("The order is canceled.","success");$("#modal-detail").modal("hide");i();n(!0)}})});$("#btnAddDetail").on("click",function(){var n=$("#template-table-bill-details").html(),t=u(null),i=f(null),r=o(null),e=Mustache.render(n,{Id:0,Products:t,Colors:i,Sizes:r,Quantity:0,Total:0});$("#tbl-bill-details").append(e)});$("#btnReturn").on("click",function(){$.ajax({url:"/Admin/Bill/UpdateStatus",type:"post",data:{billId:$("#hidId").val(),billStatus:2,status:0},dataType:"json",success:function(){osm.notify("The order is refund.","success");$("#modal-detail").modal("hide");i();n(!0)}})});$("#btnRefuse").on("click",function(){$.ajax({url:"/Admin/Bill/UpdateStatus",type:"post",data:{billId:$("#hidId").val(),billStatus:4,status:0},dataType:"json",success:function(){osm.notify("The return is refused.","success");$("#modal-detail").modal("hide");i();n(!0)}})});$("body").on("click",".btn-delete-detail",function(){$(this).parent().parent().remove()});$("#btnExport").on("click",function(){var n=$("#hidId").val();$.ajax({type:"POST",url:"/Admin/Bill/ExportExcel",data:{billId:n},beforeSend:function(){osm.startLoading()},success:function(n){window.location.href=n;osm.stopLoading()}})})}function h(){return $.ajax({type:"GET",url:"/admin/bill/GetBillStatus",dataType:"json",success:function(n){t.billStatuses=n;var i="";$.each(n,function(n,t){i+="<option value='"+t.Value+"'>"+t.Name+"<\/option>"});$("#ddlBillStatus").html(i)}})}function c(){return $.ajax({type:"GET",url:"/admin/bill/GetPaymentMethod",dataType:"json",success:function(n){t.paymentMethods=n;var i="";$.each(n,function(n,t){i+="<option value='"+t.Value+"'>"+t.Name+"<\/option>"});$("#ddlPaymentMethod").html(i)}})}function l(){return $.ajax({type:"GET",url:"/Admin/Product/GetAll",dataType:"json",success:function(n){t.products=n},error:function(){osm.notify("Has an error in progress","error")}})}function a(){return $.ajax({type:"GET",url:"/Admin/Bill/GetColors",dataType:"json",success:function(n){t.colors=n},error:function(){osm.notify("Has an error in progress","error")}})}function v(){return $.ajax({type:"GET",url:"/Admin/Bill/GetSizes",dataType:"json",success:function(n){t.sizes=n},error:function(){osm.notify("Has an error in progress","error")}})}function u(n){var i="<select class='form-control ddlProductId'>";return $.each(t.products,function(t,r){i+=n===r.Id?'<option value="'+r.Id+'" selected="select">'+r.Name+"<\/option>":'<option value="'+r.Id+'">'+r.Name+"<\/option>"}),i+="<\/select>"}function f(n){var i="<select class='form-control ddlColorId'>";return $.each(t.colors,function(t,r){i+=n===r.Id?'<option value="'+r.Id+'" selected="select">'+r.Name+"<\/option>":'<option value="'+r.Id+'">'+r.Name+"<\/option>"}),i+="<\/select>"}function o(n){var i="<select class='form-control ddlSizeId'>";return $.each(t.sizes,function(t,r){i+=n===r.Id?'<option value="'+r.Id+'" selected="select">'+r.Name+"<\/option>":'<option value="'+r.Id+'">'+r.Name+"<\/option>"}),i+="<\/select>"}function i(){$("#hidId").val(0);$("#hidCustomerId").val(0);$("#hidDC").val(new Date);$("#txtCustomerName").val("");$("#txtCustomerAddress").val("");$("#txtCustomerMobile").val("");$("#txtCustomerMessage").val("");$("#ddlPaymentMethod").val("");$("#ddlCustomerId").val("");$("#ddlBillStatus").val("");$("#tbl-bill-details").html("")}function n(t){$.ajax({type:"GET",url:"/admin/bill/GetAllPaging",data:{startDate:$("#txtFromDate").val(),endDate:$("#txtToDate").val(),keyword:$("#txtSearchKeyword").val(),status:$("#ddlStatus").val(),page:osm.configs.pageIndex,pageSize:osm.configs.pageSize},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(i){var u=$("#table-template").html(),r="";i.RowCount>0?($.each(i.Results,function(n,t){r+=Mustache.render(u,{CustomerName:t.CustomerName,Id:t.Id,PaymentMethod:y(t.PaymentMethod),DateCreated:osm.dateTimeFormatJson(t.DateCreated),BillStatus:p(t.BillStatus),Status:t.Status==1?"On Going":"Finished"})}),$("#lbl-total-records").text(i.RowCount),r!=undefined&&$("#tbl-content").html(r),w(i.RowCount,function(){n()},t)):($("#lbl-total-records").text("0"),$("#tbl-content").html(""));osm.stopLoading()},error:function(n){console.log(n)}})}function y(n){var i=$.grep(t.paymentMethods,function(t){return t.Value==n});return i.length>0?i[0].Name:""}function p(n){var n=$.grep(t.billStatuses,function(t){return t.Value==n});return n.length>0?n[0].Name:""}function w(n,t,i){var r=Math.ceil(n/osm.configs.pageSize);($("#paginationUL a").length===0||i===!0)&&($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page"));$("#paginationUL").twbsPagination({totalPages:r,visiblePages:7,first:"First",prev:"Prev",next:"Next",last:"Last",onPageClick:function(n,i){osm.configs.pageIndex=i;setTimeout(t(),200)}})}var t={products:[],colors:[],sizes:[],paymentMethods:[],billStatuses:[]},r;this.initialize=function(){$.when(h(),c(),a(),v(),l()).done(function(){n()});s()};r=document.getElementById("ddlStatus");r.addEventListener("change",function(){n(!0)})};