var BaseController=function(){this.initialize=function(){loadAnnouncement()}};function hasRead(e){$.ajax({type:"POST",url:"/admin/announcement/MarkAsRead",data:{id:e},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(){loadAnnouncement(),osm.stopLoading()},error:function(e){console.log(e)}})}function loadAnnouncement(){$.ajax({type:"GET",url:"/admin/announcement/GetAllPaging",data:{page:osm.configs.pageIndex,pageSize:osm.configs.pageSize},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(e){var t=$("#announcement-template").html(),a="";0<e.RowCount?($("#announcementArea").show(),$.each(e.Results,function(e,o){a+=Mustache.render(t,{Content:o.Content,Id:o.Id,Title:o.Title,FullName:o.FullName,Avatar:o.Avatar})}),a+=$("#announcement-tag-template").html(),$("#totalAnnouncement").text(e.RowCount),a!=null&&$("#annoncementList").html(a)):($("#announcementArea").hide(),$("#annoncementList").html("")),osm.stopLoading()},error:function(e){console.log(e)}})}var osm={configs:{pageSize:10,pageIndex:1},notify:function(e,t){$.notify(e,{// whether to hide the notification on click
clickToHide:!0,// whether to auto-hide the notification
autoHide:!0,// if autoHide, hide after milliseconds
autoHideDelay:5e3,// show the arrow pointing at the element
arrowShow:!0,// arrow size in pixels
arrowSize:5,// position defines the notification position though uses the defaults below
position:"...",// default positions
elementPosition:"top right",globalPosition:"top right",// default style
style:"bootstrap",// default class (string or [string])
className:t,// show animation
showAnimation:"slideDown",// show animation duration
showDuration:400,// hide animation
hideAnimation:"slideUp",// hide animation duration
hideDuration:200,// padding between element and notification
gap:2})},confirm:function(e,t){bootbox.confirm({message:e,buttons:{confirm:{label:"Agree",className:"btn-success"},cancel:{label:"Cancel",className:"btn-danger"}},callback:function(e){!0===e&&t()}})},dateFormatJson:function(e){if(null==e||""==e)return"";var t=new Date(e),a=t.getMonth()+1,o=t.getDate(),n=t.getFullYear(),r=t.getHours(),i=t.getMinutes();return 10>a&&(a="0"+a),10>o&&(o="0"+o),10>r&&(r="0"+r),10>i&&(i="0"+i),o+"/"+a+"/"+n},dateTimeFormatJson:function(e){if(null==e||""==e)return"";var t=new Date(e),a=t.getMonth()+1,o=t.getDate(),n=t.getFullYear(),r=t.getHours(),i=t.getMinutes(),d=t.getSeconds();return 10>a&&(a="0"+a),10>o&&(o="0"+o),10>r&&(r="0"+r),10>i&&(i="0"+i),10>d&&(d="0"+d),o+"/"+a+"/"+n+" "+r+":"+i+":"+d},startLoading:function(){0<$(".dv-loading").length&&$(".dv-loading").removeClass("hide")},stopLoading:function(){0<$(".dv-loading").length&&$(".dv-loading").addClass("hide")},getStatus:function(e){return 1==e?"<span class=\"badge bg-green\">Active</span>":"<span class=\"badge bg-red\">Locked</span>"},formatNumber:function(e,t){if(!isFinite(e))return e.toString();var o=e.toFixed(t).split(".");return o[0]=o[0].replace(/\d(?=(\d{3})+$)/g,"$&,"),o.join(".")},unflattern:function(e){for(var t,a={},o=[],n=0;n<e.length;n+=1)t=e[n],t.children=[],a[t.id]=n,null===t.parentId?o.push(t):e[a[t.parentId]].children.push(t);return o},plug:function(){var e,t;//Lấy text từ thẻ input title 
//Đổi chữ hoa thành chữ thường
//Đổi ký tự có dấu thành không dấu
//Xóa các ký tự đặt biệt
//Đổi khoảng trắng thành ký tự gạch ngang
//Đổi nhiều ký tự gạch ngang liên tiếp thành 1 ký tự gạch ngang
//Phòng trường hợp người nhập vào quá nhiều ký tự trắng
//Xóa các ký tự gạch ngang ở đầu và cuối
//In slug ra textbox có id “slug”
e=document.getElementById("txtNameM").value,console.log(e),t=e.toLowerCase(),t=t.replace(/á|à|ả|ạ|ã|ă|ắ|ằ|ẳ|ẵ|ặ|â|ấ|ầ|ẩ|ẫ|ậ/gi,"a"),t=t.replace(/é|è|ẻ|ẽ|ẹ|ê|ế|ề|ể|ễ|ệ/gi,"e"),t=t.replace(/i|í|ì|ỉ|ĩ|ị/gi,"i"),t=t.replace(/ó|ò|ỏ|õ|ọ|ô|ố|ồ|ổ|ỗ|ộ|ơ|ớ|ờ|ở|ỡ|ợ/gi,"o"),t=t.replace(/ú|ù|ủ|ũ|ụ|ư|ứ|ừ|ử|ữ|ự/gi,"u"),t=t.replace(/ý|ỳ|ỷ|ỹ|ỵ/gi,"y"),t=t.replace(/đ/gi,"d"),t=t.replace(/\`|\~|\!|\@|\#|\||\$|\%|\^|\&|\*|\(|\)|\+|\=|\,|\.|\/|\?|\>|\<|\'|\"|\:|\;|_/gi,""),t=t.replace(/ /gi," - "),t=t.replace(/\-\-\-\-\-/gi,"-"),t=t.replace(/\-\-\-\-/gi,"-"),t=t.replace(/\-\-\-/gi,"-"),t=t.replace(/\-\-/gi,"-"),t="@"+t+"@",t=t.replace(/\@\-|\-\@|\@/gi,""),console.log(t),document.getElementById("txtAliasM").value=t}};$(document).ajaxSend(function(t,e,a){if("POST"==a.type.toUpperCase()||"PUT"==a.type.toUpperCase()){var o=$("form").find("input[name='__RequestVerificationToken']").val();e.setRequestHeader("RequestVerificationToken",o)}});var connection=new signalR.HubConnectionBuilder().withUrl("/osmhub").configureLogging(signalR.LogLevel.Information).build();connection.start().catch(e=>console.error(e.toString())),connection.on("ReceiveMessage",e=>{var t=$("#announcement-template").html(),a=Mustache.render(t,{Content:e.content,Id:e.id,Title:e.title,FullName:e.fullName,Avatar:e.avatar});$("#annoncementList").prepend(a);var o=parseInt($("#totalAnnouncement").text())+1;$("#totalAnnouncement").text(o)}),connection.on("ReceiveMessage",e=>{var t=$("#announcement-template").html(),a=Mustache.render(t,{Content:e.content,Id:e.id,Title:e.title,FullName:e.fullName,Avatar:e.avatar});$("#annoncementList").prepend(a);var o=parseInt($("#totalAnnouncement").text())+1;$("#totalAnnouncement").text(o),console.log(e)});var BillController=function(){function e(){//Init validation
$("#txtFromDate, #txtToDate").datepicker({autoclose:!0,format:"dd/mm/yyyy"}),$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"en",rules:{txtCustomerName:{required:!0},txtCustomerAddress:{required:!0},txtCustomerMobile:{required:!0},txtCustomerMessage:{required:!0},ddlBillStatus:{required:!0}}}),$("#txt-search-keyword").keypress(function(t){13===t.which&&(t.preventDefault(),p())}),$("#btn-search").on("click",function(){p()}),$("#btn-create").on("click",function(){c(),$("#modal-detail").modal("show")}),$("#ddl-show-page").on("change",function(){osm.configs.pageSize=$(this).val(),osm.configs.pageIndex=1,p(!0)}),$("body").on("click",".btn-view",function(t){t.preventDefault();var e=$(this).data("id");$.ajax({type:"GET",url:"/Admin/Bill/GetById",data:{id:e},beforeSend:function(){osm.startLoading()},success:function(e){var t=e;$("#hidId").val(t.Id),$("#txtCustomerName").val(t.CustomerName),$("#txtCustomerAddress").val(t.CustomerAddress),$("#txtCustomerMobile").val(t.CustomerMobile),$("#txtCustomerMessage").val(t.CustomerMessage),$("#ddlPaymentMethod").val(t.PaymentMethod),$("#ddlCustomerId").val(t.CustomerId),$("#ddlBillStatus").val(t.BillStatus);var a=t.BillDetails;if(null!=t.BillDetails&&0<t.BillDetails.length){var o="",n=$("#template-table-bill-details").html();$.each(a,function(e,t){var a=d(t.ProductId),r=l(t.ColorId),i=s(t.SizeId);o+=Mustache.render(n,{Id:t.Id,Products:a,Colors:r,Sizes:i,Quantity:t.Quantity})}),$("#tbl-bill-details").html(o)}$("#modal-detail").modal("show"),osm.stopLoading()},error:function(){osm.notify("Has an error in progress","error"),osm.stopLoading()}})}),$("#btnSave").on("click",function(t){if($("#frmMaintainance").valid()){t.preventDefault();var e=$("#hidId").val(),a=$("#txtCustomerName").val(),o=$("#txtCustomerAddress").val(),n=$("#ddlCustomerId").val(),r=$("#txtCustomerMobile").val(),i=$("#txtCustomerMessage").val(),d=$("#ddlPaymentMethod").val(),l=$("#ddlBillStatus").val(),s=[];//bill detail
return $.each($("#tbl-bill-details tr"),function(t,a){s.push({Id:$(a).data("id"),ProductId:$(a).find("select.ddlProductId").first().val(),Quantity:$(a).find("input.txtQuantity").first().val(),ColorId:$(a).find("select.ddlColorId").first().val(),SizeId:$(a).find("select.ddlSizeId").first().val(),BillId:e})}),$.ajax({type:"POST",url:"/Admin/Bill/SaveEntity",data:{Id:e,BillStatus:l,CustomerAddress:o,CustomerId:n,CustomerMessage:i,CustomerMobile:r,CustomerName:a,PaymentMethod:d,Status:1,BillDetails:s},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(){osm.notify("Save order successful","success"),$("#modal-detail").modal("hide"),c(),osm.stopLoading(),p(!0)},error:function(){osm.notify("Has an error in progress","error"),osm.stopLoading()}}),!1}}),$("#btnAddDetail").on("click",function(){var e=$("#template-table-bill-details").html(),t=d(null),a=l(null),o=s(null),n=Mustache.render(e,{Id:0,Products:t,Colors:a,Sizes:o,Quantity:0,Total:0});$("#tbl-bill-details").append(n)}),$("body").on("click",".btn-delete-detail",function(){$(this).parent().parent().remove()}),$("#btnExport").on("click",function(){var e=$("#hidId").val();$.ajax({type:"POST",url:"/Admin/Bill/ExportExcel",data:{billId:e},beforeSend:function(){osm.startLoading()},success:function(e){window.location.href=e,osm.stopLoading()}})})}function t(){return $.ajax({type:"GET",url:"/admin/bill/GetBillStatus",dataType:"json",success:function(e){h.billStatuses=e;var t="";$.each(e,function(e,a){t+="<option value='"+a.Value+"'>"+a.Name+"</option>"}),$("#ddlBillStatus").html(t)}})}function a(){return $.ajax({type:"GET",url:"/admin/bill/GetPaymentMethod",dataType:"json",success:function(e){h.paymentMethods=e;var t="";$.each(e,function(e,a){t+="<option value='"+a.Value+"'>"+a.Name+"</option>"}),$("#ddlPaymentMethod").html(t)}})}function o(){return $.ajax({type:"GET",url:"/Admin/Product/GetAll",dataType:"json",success:function(e){h.products=e},error:function(){osm.notify("Has an error in progress","error")}})}function n(){return $.ajax({type:"GET",url:"/Admin/Bill/GetColors",dataType:"json",success:function(e){h.colors=e},error:function(){osm.notify("Has an error in progress","error")}})}function r(){return $.ajax({type:"GET",url:"/Admin/Bill/GetSizes",dataType:"json",success:function(e){h.sizes=e},error:function(){osm.notify("Has an error in progress","error")}})}function d(e){var t="<select class='form-control ddlProductId'>";return $.each(h.products,function(a,o){t+=e===o.Id?"<option value=\""+o.Id+"\" selected=\"select\">"+o.Name+"</option>":"<option value=\""+o.Id+"\">"+o.Name+"</option>"}),t+="</select>",t}function l(e){var t="<select class='form-control ddlColorId'>";return $.each(h.colors,function(a,o){t+=e===o.Id?"<option value=\""+o.Id+"\" selected=\"select\">"+o.Name+"</option>":"<option value=\""+o.Id+"\">"+o.Name+"</option>"}),t+="</select>",t}function s(e){var t="<select class='form-control ddlSizeId'>";return $.each(h.sizes,function(a,o){t+=e===o.Id?"<option value=\""+o.Id+"\" selected=\"select\">"+o.Name+"</option>":"<option value=\""+o.Id+"\">"+o.Name+"</option>"}),t+="</select>",t}function c(){$("#hidId").val(0),$("#txtCustomerName").val(""),$("#txtCustomerAddress").val(""),$("#txtCustomerMobile").val(""),$("#txtCustomerMessage").val(""),$("#ddlPaymentMethod").val(""),$("#ddlCustomerId").val(""),$("#ddlBillStatus").val(""),$("#tbl-bill-details").html("")}function p(e){$.ajax({type:"GET",url:"/admin/bill/GetAllPaging",data:{startDate:$("#txtFromDate").val(),endDate:$("#txtToDate").val(),keyword:$("#txtSearchKeyword").val(),page:osm.configs.pageIndex,pageSize:osm.configs.pageSize},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(t){var a=$("#table-template").html(),o="";0<t.RowCount?($.each(t.Results,function(e,t){o+=Mustache.render(a,{CustomerName:t.CustomerName,Id:t.Id,PaymentMethod:g(t.PaymentMethod),DateCreated:osm.dateTimeFormatJson(t.DateCreated),BillStatus:u(t.BillStatus)})}),$("#lbl-total-records").text(t.RowCount),o!=null&&$("#tbl-content").html(o),m(t.RowCount,function(){p()},e)):($("#lbl-total-records").text("0"),$("#tbl-content").html("")),osm.stopLoading()},error:function(e){console.log(e)}})}function g(e){var t=$.grep(h.paymentMethods,function(t){return t.Value==e});return 0<t.length?t[0].Name:""}function u(e){var e=$.grep(h.billStatuses,function(t){return t.Value==e});return 0<e.length?e[0].Name:""}function m(e,t,a){var o=Math.ceil(e/osm.configs.pageSize);//Unbind pagination if it existed or click change pagesize
//Bind Pagination Event
(0===$("#paginationUL a").length||!0===a)&&($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page")),$("#paginationUL").twbsPagination({totalPages:o,visiblePages:7,first:"First",prev:"Prev",next:"Next",last:"Last",onPageClick:function(e,a){osm.configs.pageIndex=a,setTimeout(t(),200)}})}var h={products:[],colors:[],sizes:[],paymentMethods:[],billStatuses:[]};this.initialize=function(){$.when(t(),a(),n(),r(),o()).done(function(){p()}),e()}},BlogController=function(){function e(){//Init validation
$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"en",rules:{txtNameM:{required:!0},txtAliasM:{required:!0}}}),$("#txt-search-keyword").keypress(function(t){13===t.which&&(t.preventDefault(),o())}),$("#btn-search").on("click",function(){o()}),$("#ddl-show-page").on("change",function(){osm.configs.pageSize=$(this).val(),osm.configs.pageIndex=1,o(!0)}),$("#btn-create").on("click",function(){t(),$("#modal-add-edit").modal("show")}),$("body").on("click",".btn-edit",function(t){t.preventDefault();var e=$(this).data("id");$.ajax({type:"GET",url:"/Admin/Blog/GetById",data:{id:e},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(e){var t=e;$("#hidIdM").val(t.Id),$("#txtNameM").val(t.Name),$("#txtAliasM").val(t.Alias),CKEDITOR.instances.txtContentM.setData(t.Content),$("#ckStatusM").prop("checked",1===t.Status),$("#modal-add-edit").modal("show"),osm.stopLoading()},error:function(){osm.notify("Has an error","error"),osm.stopLoading()}})}),$("#btnSaveM").on("click",function(a){if($("#frmMaintainance").valid()){a.preventDefault();var e=$("#hidIdM").val(),n=$("#txtNameM").val(),r=$("#txtAliasM").val(),i=CKEDITOR.instances.txtContentM.getData(),d=!0===$("#ckStatusM").prop("checked")?1:0;return $.ajax({type:"POST",url:"/Admin/Blog/SaveEntity",data:{Id:e,Name:n,Content:i,Status:d,Alias:r},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(){osm.notify("Update page successful","success"),$("#modal-add-edit").modal("hide"),t(),osm.stopLoading(),o(!0)},error:function(){osm.notify("Have an error in progress","error"),osm.stopLoading()}}),!1}return!1}),$("body").on("click",".btn-delete",function(t){t.preventDefault();var e=$(this).data("id");osm.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/Blog/Delete",data:{id:e},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(){osm.notify("Delete page successful","success"),osm.stopLoading(),o()},error:function(){osm.notify("Have an error in progress","error"),osm.stopLoading()}})})})}function t(){$("#hidIdM").val(0),$("#txtNameM").val(""),$("#txtAliasM").val(""),CKEDITOR.instances.txtContentM.setData(""),$("#ckStatusM").prop("checked",!0)}function a(){//Fix: cannot click on element ck in modal
CKEDITOR.replace("txtContentM",{filebrowserImageUploadUrl:"/Admin/Upload/UploadImageForCKEditor?type=Images"}),$.fn.modal.Constructor.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal")// guard against infinite focus loop
.on("focusin.bs.modal",$.proxy(function(t){this.$element[0]===t.target||this.$element.has(t.target).length// CKEditor compatibility fix start.
||$(t.target).closest(".cke_dialog, .cke").length// CKEditor compatibility fix end.
||this.$element.trigger("focus")},this))}}function o(e){$.ajax({type:"GET",url:"/admin/blog/GetAllPaging",data:{keyword:$("#txt-search-keyword").val(),page:osm.configs.pageIndex,pageSize:osm.configs.pageSize},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(t){var a=$("#table-template").html(),r="";0<t.RowCount?($.each(t.Results,function(e,t){r+=Mustache.render(a,{Name:t.Name,Alias:t.Alias,Id:t.Id,Status:osm.getStatus(t.Status)})}),$("#lbl-total-records").text(t.RowCount),r!=null&&$("#tbl-content").html(r),n(t.RowCount,function(){o()},e)):$("#tbl-content").html(""),osm.stopLoading()},error:function(e){console.log(e)}})}function n(e,t,a){var o=Math.ceil(e/osm.configs.pageSize);//Unbind pagination if it existed or click change pagesize
//Bind Pagination Event
(0===$("#paginationUL a").length||!0===a)&&($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page")),$("#paginationUL").twbsPagination({totalPages:o,visiblePages:7,first:"First",prev:"Prev",next:"Next",last:"Last",onPageClick:function(e,a){osm.configs.pageIndex=a,setTimeout(t(),200)}})}this.initialize=function(){o(),e(),a()}},HomeController=function(){function e(e,a){$.ajax({type:"GET",url:"/Admin/Home/GetRevenue",data:{fromDate:e,toDate:a},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(e){t(e),osm.stopLoading()},error:function(){osm.notify("Has errors!","error"),osm.stopLoading()}})}function t(e){var t=[],a=[];$.each(e,function(e,a){t.push([new Date(a.Date).getTime(),a.Revenue])}),$.each(e,function(e,t){a.push([new Date(t.Date).getTime(),t.Profit])});$("#chart_plot_02").length&&(console.log("Plot2"),$.plot($("#chart_plot_02"),[{label:"Revenue",data:t,lines:{fillColor:"rgba(150, 202, 89, 0.12)"},points:{fillColor:"#fff"}},{label:"Profit",data:a,lines:{fillColor:"rgba(140, 232, 289, 0.12)"},points:{fillColor:"#fff"}}],{grid:{show:!0,aboveData:!0,color:"#3f3f3f",labelMargin:10,axisMargin:0,borderWidth:0,borderColor:null,minBorderMargin:5,clickable:!0,hoverable:!0,autoHighlight:!0,mouseActiveRadius:100},series:{lines:{show:!0,fill:!0,lineWidth:2,steps:!1},points:{show:!0,radius:4.5,symbol:"circle",lineWidth:3}},legend:{position:"ne",margin:[0,-25],noColumns:0,labelBoxBorderColor:null,labelFormatter:function(e){return e+"&nbsp;&nbsp;"},width:40,height:1},colors:["#96CA59","#3F97EB","#72c380","#6f7a8a","#f7cb38","#5a8022","#2c7282"],shadowSize:0,tooltip:!0,tooltipOpts:{content:"%s: %y.0",xDateFormat:"%d/%m",shifts:{x:-30,y:-50},defaultTheme:!1},yaxis:{min:0},xaxis:{mode:"time",minTickSize:[1,"day"],timeformat:"%d/%m/%y"//min: arrRevenue[0][0],
//max: arrRevenue[20][0]
}}))}function a(){if("undefined"!=typeof $.fn.daterangepicker){console.log("init_daterangepicker");var t=function(e,t,a){console.log(e.toISOString(),t.toISOString(),a),$("#reportrange span").html(e.format("MMMM D, YYYY")+" - "+t.format("MMMM D, YYYY"))},a={startDate:moment().subtract(29,"days"),endDate:moment(),minDate:"01/01/2012",maxDate:moment().format("MM/DD/YYYY"),dateLimit:{days:60},showDropdowns:!0,showWeekNumbers:!0,timePicker:!1,timePickerIncrement:1,timePicker12Hour:!0,ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},opens:"left",buttonClasses:["btn btn-default"],applyClass:"btn-small btn-primary",cancelClass:"btn-small",format:"MM/DD/YYYY",separator:" to ",locale:{applyLabel:"Submit",cancelLabel:"Clear",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",daysOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],firstDay:1}};$("#reportrange span").html(moment().subtract(29,"days").format("MMMM D, YYYY")+" - "+moment().format("MMMM D, YYYY")),$("#reportrange").daterangepicker(a,t),$("#reportrange").on("show.daterangepicker",function(){console.log("show event fired")}),$("#reportrange").on("hide.daterangepicker",function(){console.log("hide event fired")}),$("#reportrange").on("apply.daterangepicker",function(t,a){console.log("apply event fired, start/end dates are "+a.startDate.format("MMMM D, YYYY")+" to "+a.endDate.format("MMMM D, YYYY")),e(a.startDate.format("MM/DD/YYYY"),a.endDate.format("MM/DD/YYYY"))}),$("#reportrange").on("cancel.daterangepicker",function(){console.log("cancel event fired")}),$("#options1").click(function(){$("#reportrange").data("daterangepicker").setOptions(a,t)}),$("#options2").click(function(){$("#reportrange").data("daterangepicker").setOptions(optionSet2,t)}),$("#destroy").click(function(){$("#reportrange").data("daterangepicker").remove()})}}this.initialize=function(){a(),e()}},loginController=function(){this.initialize=function(){e()};var e=function(){$("#frmLogin").validate({errorClass:"red",ignore:[],lang:"en",rules:{userName:{required:!0},password:{required:!0}}}),$("#btnLogin").on("click",function(a){if($("#frmLogin").valid()){a.preventDefault();var e=$("#txtUserName").val(),o=$("#txtPassword").val();t(e,o)}})},t=function(e,t){$.ajax({type:"POST",data:{Email:e,Password:t},dataType:"json",url:"/admin/login/authen",success:function(e){e.Success?window.location.href="/Admin/Home/Index":osm.notify("Your username or password is wrong!","error")}})}},PageController=function(){function e(){//Init validation
$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"en",rules:{txtNameM:{required:!0},txtAliasM:{required:!0}}}),$("#txt-search-keyword").keypress(function(t){13===t.which&&(t.preventDefault(),o())}),$("#btn-search").on("click",function(){o()}),$("#ddl-show-page").on("change",function(){osm.configs.pageSize=$(this).val(),osm.configs.pageIndex=1,o(!0)}),$("#btn-create").on("click",function(){t(),$("#modal-add-edit").modal("show")}),$("body").on("click",".btn-edit",function(t){t.preventDefault();var e=$(this).data("id");$.ajax({type:"GET",url:"/Admin/Page/GetById",data:{id:e},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(e){var t=e;$("#hidIdM").val(t.Id),$("#txtNameM").val(t.Name),$("#txtAliasM").val(t.Alias),CKEDITOR.instances.txtContentM.setData(t.Content),$("#ckStatusM").prop("checked",1===t.Status),$("#modal-add-edit").modal("show"),osm.stopLoading()},error:function(){osm.notify("C\xF3 l\u1ED7i x\u1EA3y ra","error"),osm.stopLoading()}})}),$("#btnSaveM").on("click",function(a){if($("#frmMaintainance").valid()){a.preventDefault();var e=$("#hidIdM").val(),n=$("#txtNameM").val(),r=$("#txtAliasM").val(),i=CKEDITOR.instances.txtContentM.getData(),d=!0===$("#ckStatusM").prop("checked")?1:0;return $.ajax({type:"POST",url:"/Admin/Page/SaveEntity",data:{Id:e,Name:n,Content:i,Status:d,Alias:r},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(){osm.notify("Update page successful","success"),$("#modal-add-edit").modal("hide"),t(),osm.stopLoading(),o(!0)},error:function(){osm.notify("Have an error in progress","error"),osm.stopLoading()}}),!1}return!1}),$("body").on("click",".btn-delete",function(t){t.preventDefault();var e=$(this).data("id");osm.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/Page/Delete",data:{id:e},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(){osm.notify("Delete page successful","success"),osm.stopLoading(),o()},error:function(){osm.notify("Have an error in progress","error"),osm.stopLoading()}})})})}function t(){$("#hidIdM").val(0),$("#txtNameM").val(""),$("#txtAliasM").val(""),CKEDITOR.instances.txtContentM.setData(""),$("#ckStatusM").prop("checked",!0)}function a(){//Fix: cannot click on element ck in modal
CKEDITOR.replace("txtContentM",{filebrowserImageUploadUrl:"/Admin/Upload/UploadImageForCKEditor?type=Images"}),$.fn.modal.Constructor.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal")// guard against infinite focus loop
.on("focusin.bs.modal",$.proxy(function(t){this.$element[0]===t.target||this.$element.has(t.target).length// CKEditor compatibility fix start.
||$(t.target).closest(".cke_dialog, .cke").length// CKEditor compatibility fix end.
||this.$element.trigger("focus")},this))}}function o(e){$.ajax({type:"GET",url:"/admin/page/GetAllPaging",data:{keyword:$("#txt-search-keyword").val(),page:osm.configs.pageIndex,pageSize:osm.configs.pageSize},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(t){var a=$("#table-template").html(),r="";0<t.RowCount?($.each(t.Results,function(e,t){r+=Mustache.render(a,{Name:t.Name,Alias:t.Alias,Id:t.Id,Status:osm.getStatus(t.Status)})}),$("#lbl-total-records").text(t.RowCount),r!=null&&$("#tbl-content").html(r),n(t.RowCount,function(){o()},e)):$("#tbl-content").html(""),osm.stopLoading()},error:function(e){console.log(e)}})}function n(e,t,a){var o=Math.ceil(e/osm.configs.pageSize);//Unbind pagination if it existed or click change pagesize
//Bind Pagination Event
(0===$("#paginationUL a").length||!0===a)&&($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page")),$("#paginationUL").twbsPagination({totalPages:o,visiblePages:7,first:"First",prev:"Prev",next:"Next",last:"Last",onPageClick:function(e,a){osm.configs.pageIndex=a,setTimeout(t(),200)}})}this.initialize=function(){o(),e(),a()}},ImageManagement=function(){function e(){$("body").on("click",".btn-images",function(a){a.preventDefault();var e=$(this).data("id");$("#hidId").val(e),t(),$("#modal-image-manage").modal("show")}),$("body").on("click",".btn-delete-image",function(t){t.preventDefault(),$(this).closest("div").remove()}),$("#fileImage").on("change",function(){for(var e=$(this).get(0),t=e.files,o=new FormData,n=0;n<t.length;n++)o.append(t[n].name,t[n]);$.ajax({type:"POST",url:"/Admin/Upload/UploadImage",contentType:!1,processData:!1,data:o,success:function(e){a.push(e),$("#image-list").append("<div class=\"col-md-3\"><img width=\"100\"  data-path=\""+e+"\" src=\""+e+"\"></div>"),osm.notify("Upload success!","success")},error:function(){osm.notify("There was error uploading files!","error")}})}),$("#btnSaveImages").on("click",function(){var e=[];$.each($("#image-list").find("img"),function(){e.push($(this).data("path"))}),$.ajax({url:"/admin/Product/SaveImages",data:{productId:$("#hidId").val(),images:a},type:"post",dataType:"json",success:function(){$("#modal-image-manage").modal("hide"),$("#image-list").html("")}})})}function t(){$.ajax({url:"/admin/Product/GetImages",data:{productId:$("#hidId").val()},type:"get",dataType:"json",success:function(e){var t="";$.each(e,function(e,a){t+="<div class=\"col-md-3\"><img width=\"100\" src=\""+a.Path+"\"><br/><a href=\"#\" class=\"btn-delete-image\">Delete</a></div>"}),$("#image-list").html(t)}})}var a=[];this.initialize=function(){e()}},productController=function(){function e(){//Init validation
//todo: binding events to controls
$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"en",rules:{txtNameM:{required:!0},ddlCategoryIdM:{required:!0},txtPriceM:{required:!0,number:!0}}}),$("#ddlShowPage").on("change",function(){osm.configs.pageSize=$(this).val(),osm.configs.pageIndex=1,l(!0)}),$("#btnSearch").on("click",function(){l()}),$("#txtKeyword").on("keypress",function(t){13===t.which&&l()}),$("#btnCreate").on("click",function(){i(),r(),$("#modal-add-edit").modal("show")}),$("#btnSelectImg").on("click",function(){$("#fileInputImage").click()}),$("#fileInputImage").on("change",function(){for(var e=$(this).get(0),t=e.files,a=new FormData,o=0;o<t.length;o++)a.append(t[o].name,t[o]);$.ajax({type:"POST",url:"/Admin/Upload/UploadImage",contentType:!1,processData:!1,data:a,success:function(e){$("#txtImage").val(e),osm.notify("Upload image succesful!","success")},error:function(){osm.notify("There was error uploading files!","error")}})}),$("body").on("click",".btn-edit",function(t){t.preventDefault();var e=$(this).data("id");n(e),$("#modal-add-edit").modal("show")}),$("body").on("click",".btn-delete",function(t){t.preventDefault();var e=$(this).data("id");o(e)}),$("#btnSave").on("click",function(t){a(t)}),$("#btn-import").on("click",function(){r(),$("#modal-import-excel").modal("show")}),$("#btnImportExcel").on("click",function(){// Looping over all files and add it to FormData object  
// Create FormData object  
for(var e=$("#fileInputExcel").get(0),t=e.files,a=new FormData,o=0;o<t.length;o++)a.append("files",t[o]);// Adding one more key to FormData object  
return a.append("categoryId",$("#ddlCategoryIdImportExcel").combotree("getValue")),$.ajax({url:"/Admin/Product/ImportExcel",type:"POST",data:a,processData:!1,// tell jQuery not to process the data
contentType:!1,// tell jQuery not to set contentType
success:function(){$("#modal-import-excel").modal("hide"),l()}}),!1}),$("#btn-export").on("click",function(){$.ajax({type:"POST",url:"/Admin/Product/ExportExcel",beforeSend:function(){osm.startLoading()},success:function(e){window.location.href=e,osm.stopLoading()},error:function(){osm.notify("Has an error in progress","error"),osm.stopLoading()}})})}function t(){//Fix: cannot click on element ck in modal
CKEDITOR.replace("txtContentM",{}),$.fn.modal.Constructor.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal")// guard against infinite focus loop
.on("focusin.bs.modal",$.proxy(function(t){this.$element[0]===t.target||this.$element.has(t.target).length// CKEditor compatibility fix start.
||$(t.target).closest(".cke_dialog, .cke").length// CKEditor compatibility fix end.
||this.$element.trigger("focus")},this))}}function a(t){if($("#frmMaintainance").valid()){t.preventDefault();var e=$("#hidIdM").val(),a=$("#txtNameM").val(),o=$("#ddlCategoryIdM").combotree("getValue"),n=$("#txtDescM").val(),r=$("#txtUnitM").val(),d=$("#txtPriceM").val(),s=$("#txtOriginalPriceM").val(),c=$("#txtPromotionPriceM").val(),p=$("#txtTagM").val(),g=$("#txtMetakeywordM").val(),u=$("#txtMetaDescriptionM").val(),m=$("#txtSeoPageTitleM").val(),h=$("#txtAliasM").val(),f=CKEDITOR.instances.txtContentM.getData(),y=!0==$("#ckStatusM").prop("checked")?1:0,v=$("#ckHotM").prop("checked"),x=$("#ckShowHomeM").prop("checked");//var image = $('#txtImageM').val();
return $.ajax({type:"POST",url:"/Admin/Product/SaveEntity",data:{Id:e,Name:a,CategoryId:o,Image:"",Price:d,OriginalPrice:s,PromotionPrice:c,Description:n,Content:f,HomeFlag:x,HotFlag:v,Tags:p,Unit:r,Status:y,SeoPageTitle:m,SeoAlias:h,SeoKeywords:g,SeoDescription:u},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(){osm.notify("Update product successful","success"),$("#modal-add-edit").modal("hide"),i(),osm.stopLoading(),l(!0)},error:function(){osm.notify("Has an error in save product progress","error"),osm.stopLoading()}}),!1}}function o(){osm.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/Product/Delete",data:{id:that},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(){osm.notify("Delete successful","success"),osm.stopLoading(),l()},error:function(){osm.notify("Has an error in delete progress","error"),osm.stopLoading()}})})}function n(e){$.ajax({type:"GET",url:"/Admin/Product/GetById",data:{id:e},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(e){var t=e;// $('#txtImageM').val(data.ThumbnailImage);
$("#hidIdM").val(t.Id),$("#txtNameM").val(t.Name),r(t.CategoryId),$("#txtDescM").val(t.Description),$("#txtUnitM").val(t.Unit),$("#txtPriceM").val(t.Price),$("#txtOriginalPriceM").val(t.OriginalPrice),$("#txtPromotionPriceM").val(t.PromotionPrice),$("#txtTagM").val(t.Tags),$("#txtMetakeywordM").val(t.SeoKeywords),$("#txtMetaDescriptionM").val(t.SeoDescription),$("#txtSeoPageTitleM").val(t.SeoPageTitle),$("#txtAliasM").val(t.SeoAlias),CKEDITOR.instances.txtContentM.setData(t.Content),$("#ckStatusM").prop("checked",1==t.Status),$("#ckHotM").prop("checked",t.HotFlag),$("#ckShowHomeM").prop("checked",t.HomeFlag),$("#modal-add-edit").modal("show"),osm.stopLoading()},error:function(){osm.notify("Has error","error"),osm.stopLoading()}})}function r(e){$.ajax({url:"/Admin/ProductCategory/GetAll",type:"GET",dataType:"json",async:!1,success:function(t){var a=[];$.each(t,function(e,t){a.push({id:t.Id,text:t.Name,parentId:t.ParentId,sortOrder:t.SortOrder})});var o=osm.unflattern(a);$("#ddlCategoryIdM").combotree({data:o}),$("#ddlCategoryIdImportExcel").combotree({data:o}),e!=null&&$("#ddlCategoryIdM").combotree("setValue",e)}})}function i(){//$('#txtImageM').val('');
//CKEDITOR.instances.txtContentM.setData('');
$("#hidIdM").val(0),$("#txtNameM").val(""),r(""),$("#txtDescM").val(""),$("#txtUnitM").val(""),$("#txtPriceM").val("0"),$("#txtOriginalPriceM").val(""),$("#txtPromotionPriceM").val(""),$("#txtTagM").val(""),$("#txtMetakeywordM").val(""),$("#txtMetaDescriptionM").val(""),$("#txtSeoPageTitleM").val(""),$("#txtAliasM").val(""),$("#ckStatusM").prop("checked",!0),$("#ckHotM").prop("checked",!1),$("#ckShowHomeM").prop("checked",!1)}function d(){$.ajax({type:"GET",url:"/admin/product/GetAllCategories",dataType:"json",success:function(e){var t="<option value=''>--Select category--</option>";$.each(e,function(e,a){t+="<option value='"+a.Id+"'>"+a.Name+"</option>"}),$("#ddlCategorySearch").html(t)},error:function(e){console.log(e),osm.notify("Cannot loading product category data","error")}})}function l(e){var t=$("#table-template").html(),a="";$.ajax({type:"GET",data:{categoryId:$("#ddlCategorySearch").val(),keyword:$("#txtKeyword").val(),page:osm.configs.pageIndex,pageSize:osm.configs.pageSize},url:"/admin/product/GetAllPaging",dataType:"json",success:function(o){$.each(o.Results,function(e,o){a+=Mustache.render(t,{Id:o.Id,Name:o.Name,Image:null==o.Image?"<img src=\"/admin-side/images/user.png\" width=25":"<img src=\""+o.Image+"\" width=25 />",CategoryName:o.ProductCategory.Name,Price:osm.formatNumber(o.Price,0),CreatedDate:osm.dateTimeFormatJson(o.DateCreated),Status:osm.getStatus(o.Status)})}),$("#lblTotalRecords").text(o.RowCount),""!=a&&$("#tbl-content").html(a),s(o.RowCount,function(){l()},e)},error:function(e){console.log(e),osm.notify("Cannot loading data","error")}})}function s(e,t,a){var o=Math.ceil(e/osm.configs.pageSize);//Unbind pagination if it existed or click change pagesize
//Bind Pagination Event
(0===$("#paginationUL a").length||!0===a)&&($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page")),$("#paginationUL").twbsPagination({totalPages:o,visiblePages:7,first:"First",prev:"Prev",next:"Next",last:"Last",onPageClick:function(e,a){osm.configs.pageIndex=a,setTimeout(t(),200)}})}var c=new QuantityManagement,p=new ImageManagement,g=new WholePriceManagement;this.initialize=function(){d(),l(),e(),t(),c.initialize(),p.initialize(),g.initialize()}},QuantityManagement=function(){function e(){$("body").on("click",".btn-quantity",function(a){a.preventDefault();var e=$(this).data("id");$("#hidId").val(e),t(),$("#modal-quantity-management").modal("show")}),$("body").on("click",".btn-delete-quantity",function(t){t.preventDefault(),$(this).closest("tr").remove()}),$("#btn-add-quantity").on("click",function(){var e=$("#template-table-quantity").html(),t=Mustache.render(e,{Id:0,Colors:n(null),Sizes:r(null),Quantity:0});$("#table-quantity-content").append(t)}),$("#btnSaveQuantity").on("click",function(){var e=[];$.each($("#table-quantity-content").find("tr"),function(t,a){e.push({Id:$(a).data("id"),ProductId:$("#hidId").val(),Quantity:$(a).find("input.txtQuantity").first().val(),SizeId:$(a).find("select.ddlSizeId").first().val(),ColorId:$(a).find("select.ddlColorId").first().val()})}),$.ajax({url:"/admin/Product/SaveQuantities",data:{productId:$("#hidId").val(),quantities:e},type:"post",dataType:"json",success:function(){$("#modal-quantity-management").modal("hide"),$("#table-quantity-content").html("")}})})}function t(){$.ajax({url:"/admin/Product/GetQuantities",data:{productId:$("#hidId").val()},type:"get",dataType:"json",success:function(e){var t="",a=$("#template-table-quantity").html();$.each(e,function(e,o){t+=Mustache.render(a,{Id:o.Id,Colors:n(o.ColorId),Sizes:r(o.SizeId),Quantity:o.Quantity})}),$("#table-quantity-content").html(t),resetFile()}})}function a(){return $.ajax({type:"GET",url:"/Admin/Bill/GetColors",dataType:"json",success:function(e){d.colors=e},error:function(){osm.notify("Has an error","error")}})}function o(){return $.ajax({type:"GET",url:"/Admin/Bill/GetSizes",dataType:"json",success:function(e){d.sizes=e},error:function(){osm.notify("Has an error","error")}})}function n(e){var t="<select class='form-control ddlColorId'>";return $.each(d.colors,function(a,o){t+=e===o.Id?"<option value=\""+o.Id+"\" selected=\"select\">"+o.Name+"</option>":"<option value=\""+o.Id+"\">"+o.Name+"</option>"}),t+="</select>",t}function r(e){var t="<select class='form-control ddlSizeId'>";return $.each(d.sizes,function(a,o){t+=e===o.Id?"<option value=\""+o.Id+"\" selected=\"select\">"+o.Name+"</option>":"<option value=\""+o.Id+"\">"+o.Name+"</option>"}),t+="</select>",t}var i=this,d={colors:[],sizes:[]};this.initialize=function(){a(),o(),e()}},WholePriceManagement=function(){function e(){$("body").on("click",".btn-whole-price",function(a){a.preventDefault();var e=$(this).data("id");$("#hidId").val(e),t(),$("#modal-whole-price").modal("show")}),$("body").on("click",".btn-delete-whole-price",function(t){t.preventDefault(),$(this).closest("tr").remove()}),$("#btn-add-whole-price").on("click",function(){var e=$("#template-table-whole-price").html(),t=Mustache.render(e,{Id:0,FromQuantity:0,ToQuantity:0,Price:0});$("#table-content-whole-price").append(t)}),$("#btnSaveWholePrice").on("click",function(){var e=[];$.each($("#table-content-whole-price").find("tr"),function(t,a){e.push({Id:$(a).data("id"),ProductId:$("#hidId").val(),FromQuantity:$(a).find("input.txtQuantityFrom").first().val(),ToQuantity:$(a).find("input.txtQuantityTo").first().val(),Price:$(a).find("input.txtWholePrice").first().val()})}),$.ajax({url:"/admin/Product/SaveWholePrice",data:{productId:$("#hidId").val(),wholePrices:e},type:"post",dataType:"json",success:function(){$("#modal-whole-price").modal("hide"),$("#table-content-whole-price").html("")}})})}function t(){$.ajax({url:"/admin/Product/GetWholePrices",data:{productId:$("#hidId").val()},type:"get",dataType:"json",success:function(e){var t="",a=$("#template-table-whole-price").html();$.each(e,function(e,o){t+=Mustache.render(a,{Id:o.Id,FromQuantity:o.FromQuantity,ToQuantity:o.ToQuantity,Price:o.Price})}),$("#table-content-whole-price").html(t)}})}var a=this;this.initialize=function(){e()}},productCategoryController=function(){function e(){$.ajax({url:"/Admin/ProductCategory/GetAll",dataType:"json",success:function(e){var a=[];$.each(e,function(e,t){a.push({id:t.Id,text:t.Name,parentId:t.ParentId,sortOrder:t.SortOrder})});var o=osm.unflattern(a);o.sort(function(e,t){return e.sortOrder-t.sortOrder}),$("#treeProductCategory").tree({data:o,dnd:!0,onDrop:function(e,a,o){console.log(e),console.log(a),console.log(o);var n=$(this).tree("getNode",e);if("append"===o){var r=[];//Update to database
$.each(n.children,function(e,t){r.push({key:t.id,value:e})}),$.ajax({url:"/Admin/ProductCategory/UpdateParentId",type:"post",dataType:"json",data:{sourceId:a.id,targetId:n.id,items:r},success:function(){t()}})}else("top"===o||"bottom"===o)&&$.ajax({url:"/Admin/ProductCategory/ReOrder",type:"post",dataType:"json",data:{sourceId:a.id,targetId:n.id},success:function(){t()}})}})}})}function t(e){var o=$("#table-template").html(),n="";$.ajax({type:"GET",data:{keyword:$("#txtKeyword").val(),page:osm.configs.pageIndex,pageSize:osm.configs.pageSize},url:"/admin/productCategory/GetAllPaging",dataType:"json",success:function(r){$.each(r.Results,function(e,t){n+=Mustache.render(o,{Id:t.Id,Name:t.Name,CreatedDate:osm.dateTimeFormatJson(t.DateCreated),ModifiedDate:osm.dateTimeFormatJson(t.DateModified),Status:osm.getStatus(t.Status)})}),$("#lblTotalRecords").text(r.RowCount),""!=n&&$("#tbl-content").html(n),a(r.RowCount,function(){t()},e)},error:function(e){console.log(e),osm.notify("Cannot loading data","error")}})}function a(e,t,a){var o=Math.ceil(e/osm.configs.pageSize);//Unbind pagination if it existed or click change pagesize
//Bind Pagination Event
(0===$("#paginationUL a").length||!0===a)&&($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page")),$("#paginationUL").twbsPagination({totalPages:o,visiblePages:7,first:"First",prev:"Prev",next:"Next",last:"Last",onPageClick:function(e,a){osm.configs.pageIndex=a,setTimeout(t(),200)}})}function o(){$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"en",rules:{txtNameM:{required:!0},txtOrderM:{number:!0},txtHomeOrderM:{number:!0}}}),$("#ddlShowPage").on("change",function(){osm.configs.pageSize=$(this).val(),osm.configs.pageIndex=1,t(!0)}),$("#btnSearch").on("click",function(){t()}),$("#txtKeyword").on("keypress",function(a){13===a.which&&t()}),$("#btnCreate").off("click").on("click",function(t){t.preventDefault(),n(),r(),$("#modal-add-edit").modal("show")}),$("body").on("click",".btn-edit",function(t){t.preventDefault();var e=$(this).data("id");$.ajax({type:"GET",url:"/Admin/ProductCategory/GetById",data:{id:e},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(e){var t=e;$("#hidIdM").val(t.Id),$("#txtNameM").val(t.Name),r(t.CategoryId),$("#txtDescM").val(t.Description),$("#txtImageM").val(t.ThumbnailImage),$("#txtSeoKeywordM").val(t.SeoKeywords),$("#txtSeoDescriptionM").val(t.SeoDescription),$("#txtSeoPageTitleM").val(t.SeoPageTitle),$("#txtAliasM").val(t.SeoAlias),$("#ckStatusM").prop("checked",1==t.Status),$("#ckShowHomeM").prop("checked",t.HomeFlag),$("#txtOrderM").val(t.SortOrder),$("#txtHomeOrderM").val(t.HomeOrder),$("#modal-add-edit").modal("show"),osm.stopLoading()},error:function(){osm.notify("Has an error","error"),osm.stopLoading()}})}),$("body").on("click",".btn-delete",function(a){a.preventDefault();var e=$(this).data("id");osm.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/ProductCategory/Delete",data:{id:e},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(){osm.notify("Deleted success","success"),osm.stopLoading(),t()},error:function(){osm.notify("Has an error in deleting progress","error"),osm.stopLoading()}})})}),$("#btnSelectImg").on("click",function(){$("#fileInputImage").click()}),$("#fileInputImage").on("change",function(){for(var e=$(this).get(0),t=e.files,a=new FormData,o=0;o<t.length;o++)a.append(t[o].name,t[o]);$.ajax({type:"POST",url:"/Admin/Upload/UploadImage",contentType:!1,processData:!1,data:a,success:function(e){$("#txtImageM").val(e),osm.notify("Upload image successful!","success")},error:function(){osm.notify("There was error uploading files!","error")}})}),$("#btnSave").on("click",function(a){if($("#frmMaintainance").valid()){a.preventDefault();var e=parseInt($("#hidIdM").val()),o=$("#txtNameM").val(),r=$("#ddlCategoryIdM").combotree("getValue"),i=$("#txtDescM").val(),d=$("#txtImageM").val(),l=parseInt($("#txtOrderM").val()),s=$("#txtHomeOrderM").val(),c=$("#txtSeoKeywordM").val(),p=$("#txtSeoDescriptionM").val(),g=$("#txtSeoPageTitleM").val(),u=$("#txtAliasM").val(),m=!0==$("#ckStatusM").prop("checked")?1:0,h=$("#ckShowHomeM").prop("checked");$.ajax({type:"POST",url:"/Admin/ProductCategory/SaveEntity",data:{Id:e,Name:o,Description:i,ParentId:r,HomeOrder:s,SortOrder:l,HomeFlag:h,Image:d,Status:m,SeoPageTitle:g,SeoAlias:u,SeoKeywords:c,SeoDescription:p},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(){osm.notify("Update success","success"),$("#modal-add-edit").modal("hide"),n(),osm.stopLoading(),t(!0)},error:function(){osm.notify("Has an error in update progress","error"),osm.stopLoading()}})}return!1})}function n(){$("#hidIdM").val(0),$("#txtNameM").val(""),r(""),$("#txtDescM").val(""),$("#txtOrderM").val(""),$("#txtHomeOrderM").val(""),$("#txtImageM").val(""),$("#txtMetakeywordM").val(""),$("#txtMetaDescriptionM").val(""),$("#txtSeoPageTitleM").val(""),$("#txtAliasM").val(""),$("#ckStatusM").prop("checked",!0),$("#ckShowHomeM").prop("checked",!1)}function r(e){$.ajax({url:"/Admin/ProductCategory/GetAll",type:"GET",dataType:"json",async:!1,success:function(t){var a=[];$.each(t,function(e,t){a.push({id:t.Id,text:t.Name,parentId:t.ParentId,sortOrder:t.SortOrder})});var o=osm.unflattern(a);$("#ddlCategoryIdM").combotree({data:o}),e!=null&&$("#ddlCategoryIdM").combotree("setValue",e)}})}this.initialize=function(){e(),t(),o()}},RoleController=function(){function e(){//Init validation
$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"en",rules:{txtName:{required:!0}}}),$("#txt-search-keyword").keypress(function(t){13==t.which&&(t.preventDefault(),a())}),$("#btn-search").on("click",function(){a()}),$("#ddl-show-page").on("change",function(){osm.configs.pageSize=$(this).val(),osm.configs.pageIndex=1,a(!0)}),$("#btn-role-create").on("click",function(){t(),$("#modal-add-edit").modal("show")}),$("body").on("click",".btn-grant",function(){$("#hidRoleId").val($(this).data("id")),$.when(o()).done(n($("#hidRoleId").val())),$("#modal-grantpermission").modal("show")}),$("body").on("click",".btn-role-edit",function(t){t.preventDefault();var e=$(this).data("id");$.ajax({type:"GET",url:"/Admin/Role/GetById",data:{id:e},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(e){var t=e;$("#hidId").val(t.Id),$("#txtName").val(t.Name),$("#txtDescription").val(t.Description),$("#modal-add-edit").modal("show"),osm.stopLoading()},error:function(){osm.notify("Has errors!","error"),osm.stopLoading()}})}),$("#btnSavePermission").off("click").on("click",function(){var e=[];$.each($("#tblFunction tbody tr"),function(t,a){e.push({RoleId:$("#hidRoleId").val(),FunctionId:$(a).data("id"),CanRead:$(a).find(".ckView").first().prop("checked"),CanCreate:$(a).find(".ckAdd").first().prop("checked"),CanUpdate:$(a).find(".ckEdit").first().prop("checked"),CanDelete:$(a).find(".ckDelete").first().prop("checked")})}),$.ajax({type:"POST",url:"/admin/role/SavePermission",data:{listPermmission:e,roleId:$("#hidRoleId").val()},beforeSend:function(){osm.startLoading()},success:function(){osm.notify("Save permission successful","success"),$("#modal-grantpermission").modal("hide"),osm.stopLoading()},error:function(){osm.notify("Has an error in save permission progress","error"),osm.stopLoading()}})}),$("#btnSave").on("click",function(o){if($("#frmMaintainance").valid()){o.preventDefault();var e=$("#hidId").val(),n=$("#txtName").val(),r=$("#txtDescription").val();return $.ajax({type:"POST",url:"/Admin/Role/SaveEntity",data:{Id:e,Name:n,Description:r},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(){osm.notify("Update role successful","success"),$("#modal-add-edit").modal("hide"),t(),osm.stopLoading(),a(!0)},error:function(){osm.notify("Has an error","error"),osm.stopLoading()}}),!1}}),$("body").on("click",".btn-delete",function(t){t.preventDefault();var e=$(this).data("id");osm.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/Role/Delete",data:{id:e},beforeSend:function(){osm.startLoading()},success:function(){osm.notify("Delete successful","success"),osm.stopLoading(),a()},error:function(){osm.notify("Has an error in deleting progress","error"),osm.stopLoading()}})})})}function t(){$("#hidId").val(""),$("#txtName").val(""),$("#txtDescription").val("")}function a(e){$.ajax({type:"GET",url:"/admin/role/GetAllPaging",data:{keyword:$("#txt-search-keyword").val(),page:osm.configs.pageIndex,pageSize:osm.configs.pageSize},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(t){var o=$("#table-template").html(),n="";0<t.RowCount?($.each(t.Results,function(e,t){n+=Mustache.render(o,{Name:t.Name,Id:t.Id,Description:t.Description})}),$("#lbl-total-records").text(t.RowCount),n!=null&&$("#tbl-content").html(n),r(t.RowCount,function(){a()},e)):$("#tbl-content").html(""),osm.stopLoading()},error:function(e){console.log(e)}})}function o(e){return $.ajax({type:"GET",url:"/admin/Function/GetAll",dataType:"json",beforeSend:function(){osm.startLoading()},success:function(t){var a=$("#result-data-function").html(),o="";$.each(t,function(e,t){o+=Mustache.render(a,{Name:t.Name,treegridparent:null==t.ParentId?"":"treegrid-parent-"+t.ParentId,Id:t.Id,AllowCreate:t.AllowCreate?"checked":"",AllowEdit:t.AllowEdit?"checked":"",AllowView:t.AllowView?"checked":"",AllowDelete:t.AllowDelete?"checked":"",Status:osm.getStatus(t.Status)})}),o!=null&&$("#lst-data-function").html(o),$(".tree").treegrid(),$("#ckCheckAllView").on("click",function(){$(".ckView").prop("checked",$(this).prop("checked"))}),$("#ckCheckAllCreate").on("click",function(){$(".ckAdd").prop("checked",$(this).prop("checked"))}),$("#ckCheckAllEdit").on("click",function(){$(".ckEdit").prop("checked",$(this).prop("checked"))}),$("#ckCheckAllDelete").on("click",function(){$(".ckDelete").prop("checked",$(this).prop("checked"))}),$(".ckView").on("click",function(){$(".ckView:checked").length==t.length?$("#ckCheckAllView").prop("checked",!0):$("#ckCheckAllView").prop("checked",!1)}),$(".ckAdd").on("click",function(){$(".ckAdd:checked").length==t.length?$("#ckCheckAllCreate").prop("checked",!0):$("#ckCheckAllCreate").prop("checked",!1)}),$(".ckEdit").on("click",function(){$(".ckEdit:checked").length==t.length?$("#ckCheckAllEdit").prop("checked",!0):$("#ckCheckAllEdit").prop("checked",!1)}),$(".ckDelete").on("click",function(){$(".ckDelete:checked").length==t.length?$("#ckCheckAllDelete").prop("checked",!0):$("#ckCheckAllDelete").prop("checked",!1)}),e!=null&&e(),osm.stopLoading()},error:function(e){console.log(e)}})}function n(e){return $.ajax({type:"POST",url:"/Admin/Role/ListAllFunction",data:{roleId:e},dataType:"json",beforeSend:function(){osm.stopLoading()},success:function(e){$.each($("#tblFunction tbody tr"),function(t,a){$.each(e,function(e,t){t.FunctionId==$(a).data("id")&&($(a).find(".ckView").first().prop("checked",t.CanRead),$(a).find(".ckAdd").first().prop("checked",t.CanCreate),$(a).find(".ckEdit").first().prop("checked",t.CanUpdate),$(a).find(".ckDelete").first().prop("checked",t.CanDelete))})}),$(".ckView:checked").length==$("#tblFunction tbody tr .ckView").length?$("#ckCheckAllView").prop("checked",!0):$("#ckCheckAllView").prop("checked",!1),$(".ckAdd:checked").length==$("#tblFunction tbody tr .ckAdd").length?$("#ckCheckAllCreate").prop("checked",!0):$("#ckCheckAllCreate").prop("checked",!1),$(".ckEdit:checked").length==$("#tblFunction tbody tr .ckEdit").length?$("#ckCheckAllEdit").prop("checked",!0):$("#ckCheckAllEdit").prop("checked",!1),$(".ckDelete:checked").length==$("#tblFunction tbody tr .ckDelete").length?$("#ckCheckAllDelete").prop("checked",!0):$("#ckCheckAllDelete").prop("checked",!1),osm.stopLoading()},error:function(e){console.log(e)}})}function r(e,t,a){var o=Math.ceil(e/osm.configs.pageSize);//Unbind pagination if it existed or click change pagesize
//Bind Pagination Event
(0===$("#paginationUL a").length||!0===a)&&($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page")),$("#paginationUL").twbsPagination({totalPages:o,visiblePages:7,first:"First",prev:"Prev",next:"Next",last:"Last",onPageClick:function(e,a){osm.configs.pageIndex=a,setTimeout(t(),200)}})}this;this.initialize=function(){a(),e()}},UserController=function(){function e(){//Init validation
$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"en",rules:{txtFullName:{required:!0},txtUserName:{required:!0},txtPassword:{required:!0,minlength:6},txtConfirmPassword:{equalTo:"#txtPassword"},txtEmail:{required:!0,email:!0}}}),$("#txt-search-keyword").keypress(function(t){13===t.which&&(t.preventDefault(),n())}),$("#btn-search").on("click",function(){n()}),$("#ddl-show-page").on("change",function(){osm.configs.pageSize=$(this).val(),osm.configs.pageIndex=1,n(!0)}),$("#btn-create").on("click",function(){a(),o(),$("#modal-add-edit").modal("show")}),$("body").on("click",".btn-edit",function(a){a.preventDefault();var e=$(this).data("id");$.ajax({type:"GET",url:"/Admin/User/GetById",data:{id:e},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(e){var a=e;$("#hidId").val(a.Id),$("#txtFullName").val(a.FullName),$("#txtUserName").val(a.UserName),$("#txtEmail").val(a.Email),$("#txtPhoneNumber").val(a.PhoneNumber),$("#ckStatus").prop("checked",1===a.Status),o(a.Roles),t(!0),$("#modal-add-edit").modal("show"),osm.stopLoading()},error:function(){osm.notify("Has errors!","error"),osm.stopLoading()}})}),$("#btnSave").on("click",function(t){if($("#frmMaintainance").valid()){t.preventDefault();var e=$("#hidId").val(),o=$("#txtFullName").val(),r=$("#txtUserName").val(),i=$("#txtPassword").val(),d=$("#txtEmail").val(),l=$("#txtPhoneNumber").val(),s=[];$.each($("input[name=\"ckRoles\"]"),function(e,t){!0===$(t).prop("checked")&&s.push($(t).prop("value"))});var c=!0===$("#ckStatus").prop("checked")?1:0;$.ajax({type:"POST",url:"/Admin/User/SaveEntity",data:{Id:e,FullName:o,UserName:r,Password:i,Email:d,PhoneNumber:l,Status:c,Roles:s},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(){osm.notify("Save user successful","success"),$("#modal-add-edit").modal("hide"),a(),osm.stopLoading(),n(!0)},error:function(){osm.notify("Has an error","error"),osm.stopLoading()}})}return!1}),$("body").on("click",".btn-delete",function(t){t.preventDefault();var e=$(this).data("id");osm.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/User/Delete",data:{id:e},beforeSend:function(){osm.startLoading()},success:function(){osm.notify("Delete successful","success"),osm.stopLoading(),n()},error:function(){osm.notify("Has an error","error"),osm.stopLoading()}})})})}function t(e){$("#txtUserName").prop("disabled",e),$("#txtPassword").prop("disabled",e),$("#txtConfirmPassword").prop("disabled",e)}function a(){t(!1),$("#hidId").val(""),o(),$("#txtFullName").val(""),$("#txtUserName").val(""),$("#txtPassword").val(""),$("#txtConfirmPassword").val(""),$("input[name=\"ckRoles\"]").removeAttr("checked"),$("#txtEmail").val(""),$("#txtPhoneNumber").val(""),$("#ckStatus").prop("checked",!0)}function o(e){$.ajax({url:"/Admin/Role/GetAll",type:"GET",dataType:"json",async:!1,success:function(t){var a=$("#role-template").html(),o="";$.each(t,function(t,n){var r="";e!==void 0&&-1!==e.indexOf(n.Name)&&(r="checked"),o+=Mustache.render(a,{Name:n.Name,Description:n.Description,Checked:r})}),$("#list-roles").html(o)}})}function n(e){$.ajax({type:"GET",url:"/admin/user/GetAllPaging",data:{categoryId:$("#ddl-category-search").val(),keyword:$("#txt-search-keyword").val(),page:osm.configs.pageIndex,pageSize:osm.configs.pageSize},dataType:"json",beforeSend:function(){osm.startLoading()},success:function(t){var a=$("#table-template").html(),o="";0<t.RowCount?($.each(t.Results,function(e,t){o+=Mustache.render(a,{FullName:t.FullName,Id:t.Id,UserName:t.UserName,Avatar:t.Avatar===void 0?"<img src=\"/admin-side/images/user.png\" width=25 />":"<img src=\""+t.Avatar+"\" width=25 />",DateCreated:osm.dateTimeFormatJson(t.DateCreated),Status:osm.getStatus(t.Status)})}),$("#lbl-total-records").text(t.RowCount),o!==void 0&&$("#tbl-content").html(o),r(t.RowCount,function(){n()},e)):$("#tbl-content").html(""),osm.stopLoading()},error:function(e){console.log(e)}})}function r(e,t,a){var o=Math.ceil(e/osm.configs.pageSize);//Unbind pagination if it existed or click change pagesize
//Bind Pagination Event
(0===$("#paginationUL a").length||!0===a)&&($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page")),$("#paginationUL").twbsPagination({totalPages:o,visiblePages:7,first:"First",prev:"Prev",next:"Next",last:"Last",onPageClick:function(e,a){osm.configs.pageIndex=a,setTimeout(t(),200)}})}this.initialize=function(){n(),e()}};